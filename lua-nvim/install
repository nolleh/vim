#!/usr/bin/env bash

source ./func
INSTALL_PATH=$HOME/.config/nvim/lua/custom

main() {
  cp -r ./* "$INSTALL_PATH"
  opts "$@"
  if [ $PACKAGE = true ]; then
		echo "install packages"

		# pnpm
		PNPM=$(which pnpm)
		if [ -z "$PNPM" ]; then
			echo "install pnpm"
			curl -fsSL https://get.pnpm.io/install.sh | sh -
		fi

		## telescope
		install ripgrep brew

		## lsp
		install bash-language-server brew

		## formatting
		install prettier brew
		install stylua brew
		install shfmt brew
		install black brew

		## etc
		install code-minimap brew
	fi

  [ $CONF = true ] && FILEPATH="$INSTALL_PATH/post-init.lua" || FILEPATH=$FILE

  if [ ! -z "$FILEPATH" ]; then
    echo "post process for init-lua using ($FILEPATH)"
    # sed -i '' -E 's/-- autogen {{{\_.*-- autogen }}}//' ./init.lua 
#     RPL=$(tr '\n' '\f' < init.lua | 
#       sed -e 's/-- autogen {{{.*\f*.*-- autogen }}}//' | tr '\f' '\n')
#     # remove prev data
#     cat <<EOF > "$INSTALL_PATH"/init.lua
# $RPL
# EOF
  cat "$FILEPATH" >> "$INSTALL_PATH"/init.lua
  fi
}

install() {
	case $2 in
	'brew')
		INSTALLED=$(brew list | grep "$1")
		if [ -z "$INSTALLED" ]; then
			brew install "$1"
		fi
		;;
	'pnpm')
		INSTALLED=$(pnpm list | grep "$1")
		if [ -z "$INSTALLED" ]; then
			pnpm i -g "$2"
		fi
		;;
	*)
		echo "unknown command: $2"
		;;
	esac
}

main "$@"
